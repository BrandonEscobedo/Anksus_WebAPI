@page "/MisCuestionarios"
@inject ICuestionariosService _cuestionarioService;
@inject ICuestionarioAService  _CuestionarioActivoService;
@inject NavigationManager _NavigationManager;
@inject HubConnecionService HubService
@if (cuestionarios == null)
{
    <h1> Cargando Cuestionarios...</h1>
}
else if (cuestionarios.Any())
{
@foreach(CuestionarioDTO cuestionario in cuestionarios)
    {    
    <div class="container d-flex justify-content-center">
        <div class="card mx-auto" style="width: 30rem;">
             <img src="..." class="card-img-top" alt="...">
              <div class="card-body">
            <h5 class="card-title">Titulo del cuestionario: @cuestionario.Titulo</h5>
            <p class="card-text">Cantidad de preguntas: 10</p>
            <a href="#" class="card-link"><i class="fas fa-pencil-alt"></i></a>
            <a href="#" class="card-link"><i class="fas fa-trash-alt"></i></a>
                    <a href="#" @onclick="()=> IniciarCuestionario(cuestionario.IdCuestionario)" class="btn btn-success">Comenzar</a>
                    <a href="#" class="btn btn-secondary">Editar</a>
             </div>
         </div>
    </div>

    }
}
else
{
   <h1>Aun no tienes cuestionarios</h1>
    <a href="CrearCuestionario">Crear cuestionarios</a>
}
@code {
    List<CuestionarioDTO>? cuestionarios;

    protected override async Task OnInitializedAsync()
    {
        cuestionarios = await _cuestionarioService.GetCuestionario();
    }
    private async Task IniciarCuestionario(int id )
    {
        var result  = await _CuestionarioActivoService.ActivarCuestionario(id);
        if (result.EsCorrecto == true)
        {
            await HubService.NewRom(result.Valor!.codigo);
            _NavigationManager.NavigateTo($"/Lobby/{result.Valor!.codigo}");
        }
        else if (result.EsCorrecto == false && result.Valor?.codigo != 0)
        {
            Console.WriteLine("Tiene un cuestionario activo");
            _NavigationManager.NavigateTo("/MisCuestionarios");

        }

    }
}
